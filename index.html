<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Neural Network</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ==== Your existing CSS ==== */
* {margin:0;padding:0;box-sizing:border-box;}
canvas{display:block;width:100%;height:100%;cursor:pointer;position:absolute;top:0;left:0;z-index:1;}
.ui-panel{position:absolute;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);background:rgba(0,0,0,.7);border-radius:12px;border:1px solid rgba(255,120,50,.3);box-shadow:0 4px 20px rgba(0,0,0,.5);z-index:10;padding:15px;color:#eee;font-family:'Inter',sans-serif;}
#instructions-container{top:20px;left:20px;font-size:14px;line-height:1.5;max-width:280px;}
#instruction-title{font-weight:600;margin-bottom:6px;font-size:15px;}
#theme-selector{top:20px;right:20px;display:flex;flex-direction:column;gap:12px;max-width:150px;}
#theme-selector-title{font-weight:600;font-size:15px;margin-bottom:2px;}
.theme-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;}
.theme-button{width:36px;height:36px;border-radius:8px;border:2px solid rgba(255,255,255,.3);cursor:pointer;transition:transform .2s,border-color .2s;outline:none;overflow:hidden;}
.theme-button:hover,.theme-button:focus{transform:scale(1.05);border-color:rgba(255,255,255,.7);}
.theme-button.active{transform:scale(1.05);border-color:rgba(255,255,255,.9);box-shadow:0 0 10px rgba(255,200,150,.6);}
#theme-1 { background: linear-gradient(45deg, #4F46E5, #7C3AED, #C026D3, #DB2777); }
#theme-2 { background: linear-gradient(45deg, #F59E0B, #F97316, #DC2626, #7F1D1D); }
#theme-3 { background: linear-gradient(45deg, #EC4899, #8B5CF6, #6366F1, #3B82F6); }
#theme-4 { background: linear-gradient(45deg, #10B981, #A3E635, #FACC15, #FB923C); }

#density-controls{margin-top:8px;display:flex;flex-direction:column;gap:8px;}
.density-label{font-size:13px;display:flex;justify-content:space-between;}
.density-slider{width:100%;appearance:none;height:4px;border-radius:2px;background:rgba(255,120,50,.3);outline:none;cursor:pointer;}
.density-slider::-webkit-slider-thumb{appearance:none;width:14px;height:14px;border-radius:50%;background:rgba(255,120,50,.8);cursor:pointer;transition:transform .1s, background .1s;}
.density-slider::-moz-range-thumb{width:14px;height:14px;border-radius:50%;background:rgba(255,120,50,.8);cursor:pointer;border:none;transition:transform .1s, background .1s;}
.density-slider::-webkit-slider-thumb:hover{transform:scale(1.1);background:rgba(255,140,50,1);}
.density-slider::-moz-range-thumb:hover{transform:scale(1.1);background:rgba(255,140,50,1);}
#control-buttons{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:15px;z-index:10;background:rgba(0,0,0,.6);padding:10px 15px;border-radius:10px;border:1px solid rgba(255,120,50,.2);}
.control-button{background:rgba(255,120,50,.2);color:#eee;border:1px solid rgba(255,150,50,.3);padding:8px 15px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:600;transition:background-color .2s,transform .1s;white-space:nowrap;min-width:80px;text-align:center;font-family:'Inter',sans-serif;}
.control-button:hover,.control-button:focus{background:rgba(255,120,50,.4);outline:none;}
.control-button:active{background:rgba(255,120,50,.6);transform:scale(0.95);}
</style>
</head>

<body>

<div id="instructions-container" class="ui-panel">
    <div id="instruction-title">Interactive Neural Network</div>
    <div>Click or tap to create energy pulses through the network. Drag to rotate.</div>
</div>

<div id="theme-selector" class="ui-panel">
    <div id="theme-selector-title">Visual Theme</div>
    <div class="theme-grid">
        <button class="theme-button" id="theme-1" data-theme="0" aria-label="Theme 1"></button>
        <button class="theme-button" id="theme-2" data-theme="1" aria-label="Theme 2"></button>
        <button class="theme-button" id="theme-3" data-theme="2" aria-label="Theme 3"></button>
        <button class="theme-button" id="theme-4" data-theme="3" aria-label="Theme 4"></button>
    </div>
    <div id="density-controls">
        <div class="density-label"><span>Density</span><span id="density-value">100%</span></div>
        <input type="range" min="20" max="100" value="100" class="density-slider" id="density-slider" aria-label="Network Density">
    </div>
</div>

<div id="control-buttons">
    <button id="change-formation-btn" class="control-button">Formation</button>
    <button id="pause-play-btn" class="control-button">Pause</button>
    <button id="reset-camera-btn" class="control-button">Reset Cam</button>
</div>

<canvas id="neural-network-canvas"></canvas>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';
import { FilmPass } from 'three/addons/postprocessing/FilmPass.js';
import { OutputPass } from 'three/addons/postprocessing/OutputPass.js';

const config = { paused:false, activePaletteIndex:1, densityFactor:1 };

const colorPalettes = [
    [0x4F46E5,0x7C3AED,0xC026D3,0xDB2777,0x8B5CF6],
    [0xF59E0B,0xF97316,0xDC2626,0x7F1D1D,0xFBBF24],
    [0xEC4899,0x8B5CF6,0x6366F1,0x3B82F6,0xA855F7],
    [0x10B981,0xA3E635,0xFACC15,0xFB923C,0x4ADE80]
];

const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x000000, 0.0015);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1200);
camera.position.set(0,5,22);

const renderer = new THREE.WebGLRenderer({canvas: document.getElementById('neural-network-canvas'), antialias:true, powerPreference:"high-performance"});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
renderer.setClearColor(0x000000);
renderer.outputColorSpace = THREE.SRGBColorSpace;

// Starfield
function createStarfield(){
    const count=5000,pos=[];
    for(let i=0;i<count;i++){
        const r=THREE.MathUtils.randFloat(40,120);
        const phi=Math.acos(THREE.MathUtils.randFloatSpread(2));
        const theta=THREE.MathUtils.randFloat(0,Math.PI*2);
        pos.push(r*Math.sin(phi)*Math.cos(theta), r*Math.sin(phi)*Math.sin(theta), r*Math.cos(phi));
    }
    const geo=new THREE.BufferGeometry();
    geo.setAttribute('position', new THREE.Float32BufferAttribute(pos,3));
    const mat=new THREE.PointsMaterial({color:0xffffff, size:0.15, sizeAttenuation:true, depthWrite:false, opacity:0.8, transparent:true});
    return new THREE.Points(geo,mat);
}
scene.add(createStarfield());

// Controls
const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping=true; controls.dampingFactor=0.05;
controls.rotateSpeed=0.5; controls.autoRotate=true; controls.autoRotateSpeed=0.15;
controls.minDistance=5; controls.maxDistance=100; controls.enablePan=false;

// Postprocessing
const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene,camera));
composer.addPass(new UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),1.5,0.4,0.68));
composer.addPass(new FilmPass(0.35,0.55,2048,false));
composer.addPass(new OutputPass());

// Animation loop
let clock = new THREE.Clock();
function animate(){
    requestAnimationFrame(animate);
    if(!config.paused){
        controls.update();
    }
    composer.render();
}
animate();

// Handle resizing
window.addEventListener('resize',()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
    composer.setSize(window.innerWidth,window.innerHeight);
});

// Pause/play button
document.getElementById('pause-play-btn').addEventListener('click', ()=>{
    config.paused = !config.paused;
    document.getElementById('pause-play-btn').textContent = config.paused ? 'Play' : 'Pause';
});
</script>
</body>
</html>
